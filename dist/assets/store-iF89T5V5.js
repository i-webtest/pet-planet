/* empty css              */(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))c(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&c(a)}).observe(document,{childList:!0,subtree:!0});function r(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function c(o){if(o.ep)return;o.ep=!0;const s=r(o);fetch(o.href,s)}})();const i="https://cypress-picturesque-echo.glitch.me",I=document.querySelectorAll(".store__category-button"),f=document.querySelector(".store__list"),h=document.querySelector(".store__cart-button"),$=h.querySelector(".store__cart-count"),n=document.querySelector(".modal-overlay"),d=document.querySelector(".modal_cart-items");document.querySelector(".modal-overlay_close-button");const C=document.querySelector(".modal__cart-price"),S=document.querySelector(".modal__cart-form"),l=document.createElement("div");l.classList.add("order-message");const y=document.createElement("p");y.classList.add("order-message__text");const u=document.createElement("button");u.classList.add("order-message__close-button");u.textContent="Закрыть";l.append(y,u);u.addEventListener("click",()=>{l.remove()});const E=({id:e,name:t,photoUrl:r,price:c})=>{const o=document.createElement("li");return o.classList.add("store__item"),o.innerHTML=`
    <article class="store__product product">
      <img class="product__image" src="${i}${r}" alt="${t}" width="388" height="261"/>

      <h3 class="product__title">${t}</h3>

      <p class="product__price">${c}&nbsp;₽</p>

      <button class="product__btn-add-cart" data-id="${e}">Заказать</button>
    </article>
  `,o},O=e=>{f.textContent="",e.forEach(t=>{const r=E(t);f.append(r)})},b=async e=>{try{const t=await fetch(`${i}/api/products/category/${e}`);if(!t.ok)throw new Error(t.status);const r=await t.json();O(r)}catch(t){console.log(`Ошибка запроса товаров: ${t}`)}},w=async e=>{try{const t=await fetch(`${i}/api/products/list/${e.join(",")}`);if(!t.ok)throw new Error(t.status);return await t.json()}catch(t){return console.error(`Ошибка запроса товаров для корзины: ${t}`),[]}},x=({target:e})=>{const t=e.textContent;I.forEach(r=>{r.classList.remove("store__category-button_active")}),e.classList.add("store__category-button_active"),b(t)};I.forEach(e=>{e.addEventListener("click",x),e.classList.contains("store__category-button_active")&&b(e.textContent)});const P=(e,t)=>e.reduce((r,c)=>{const o=t.find(s=>s.id===c.id);return r+o.price*c.count},0),L=async()=>{d.textContent="";const e=JSON.parse(localStorage.getItem("cartItems")||"[]"),t=JSON.parse(localStorage.getItem("cartProductDetails")||"[]");t.forEach(({id:c,name:o,photoUrl:s,price:a})=>{const p=e.find(v=>v.id===c);if(!p)return;const _=document.createElement("li");_.classList.add("modal__cart-item"),_.innerHTML=`
      <img class="modal__cart-item-image" src="${i}${s}" alt="${o}" />

      <h3 class="modal__cart-item-title">${o}</h3>

      <div class="modal__cart-item-count">
        <button class="modal__btn modal__minus" data-id=${c}>-</button>
        <span class="modal__count">${p.count}</span>
        <button class="modal__btn modal__plus" data-id=${c}>+</button>
      </div>

      <p class="modal__cart-item-price">${a*p.count}&nbsp;₽</p>
    `,d.append(_)});const r=P(e,t);C.innerHTML=`${r}&nbsp;₽`};h.addEventListener("click",async()=>{n.style.display="flex";const t=JSON.parse(localStorage.getItem("cartItems")||"[]").map(c=>c.id);if(!t.length){d.textContent="";const c=document.createElement("li");c.textContent="Корзина пуста",d.append(c);return}const r=await w(t);localStorage.setItem("cartProductDetails",JSON.stringify(r)),L()});n.addEventListener("click",({target:e})=>{(e===n||e.closest(".modal-overlay_close-button"))&&(n.style.display="none")});const m=()=>{const e=JSON.parse(localStorage.getItem("cartItems")||"[]");$.textContent=e.length};m();const N=e=>{const t=JSON.parse(localStorage.getItem("cartItems")||"[]"),r=t.find(c=>c.id===e);r?r.count+=1:t.push({id:e,count:1}),localStorage.setItem("cartItems",JSON.stringify(t)),m()};f.addEventListener("click",({target:e})=>{if(e.closest(".product__btn-add-cart")){const t=e.dataset.id;N(t)}});const g=(e,t)=>{const r=JSON.parse(localStorage.getItem("cartItems")||"[]"),c=r.findIndex(o=>o.id===e);c!==-1&&(r[c].count+=t,r[c].count<=0&&r.splice(c,1),localStorage.setItem("cartItems",JSON.stringify(r)),m(),L())};d.addEventListener("click",({target:e})=>{if(e.classList.contains("modal__plus")){const t=e.dataset.id;g(t,1)}if(e.classList.contains("modal__minus")){const t=e.dataset.id;g(t,-1)}});const q=async e=>{e.preventDefault();const t=S.store.value,c=JSON.parse(localStorage.getItem("cartItems")||"[]").map(({id:o,count:s})=>({id:o,quantity:s}));try{const o=await fetch(`${i}/api/orders`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({storeId:t,products:c})});if(!o.ok)throw new Error(o.status);localStorage.removeItem("cartItems"),localStorage.removeItem("cartProductDetails");const{orderId:s}=await o.json();y.textContent=`Ваш заказ оформлен! Номер заказа: ${s}`,document.body.append(l),n.style.display="none",m()}catch(o){console.error(`Ошибка оформления заказа: ${o}`)}};S.addEventListener("submit",q);
